# LINE to Obsidian プラグイン テスト計画書

## 1. テスト環境

### 1.1 テスト環境構成
- Obsidian: バージョン 1.4.x 以上
- Node.js: 16.x 以上
- Cloudflare Workers
- LINE Developer アカウント

### 1.2 テスト前準備
- Obsidianプラグインのビルド
  - `npm run build` コマンドでビルド
- プラグインファイルの配置
  - `.obsidian/plugins/line-to-obsidian/` に必要ファイルを配置
- Cloudflare Workersのデプロイ
- LINE Webhook URLの設定

## 2. テスト項目

### 2.1 ローカルサーバー機能テスト

| No. | テスト項目 | 手順 | 期待結果 | 結果 |
|-----|------------|------|----------|------|
| 1-1 | サーバー起動 | プラグインを有効化 | ポート51828でサーバーが起動 | □ |
| 1-2 | サーバー停止 | プラグインを無効化 | サーバーが正常に停止 | □ |
| 1-3 | ポート競合 | 他のアプリが同じポートを使用 | エラー通知と代替ポートの提案 | □ |
| 1-4 | 認証チェック | 無効なトークンでリクエスト | 401エラーを返却 | □ |
| 1-5 | 不正なメソッド | GETリクエストを送信 | 405エラーを返却 | □ |

### 2.2 メッセージ処理テスト

| No. | テスト項目 | 手順 | 期待結果 | 結果 |
|-----|------------|------|----------|------|
| 2-1 | 通常メッセージ | 標準的なテキスト送信 | Markdownファイルが作成される | □ |
| 2-2 | 長文メッセージ | 1000文字以上のテキスト | 正常に保存される | □ |
| 2-3 | 特殊文字 | 絵文字や記号を含むテキスト | 文字化けせず保存 | □ |
| 2-4 | 重複メッセージ | 同じメッセージを複数回送信 | 個別のファイルとして保存 | □ |
| 2-5 | 空メッセージ | 空のテキストを送信 | 適切なエラー処理 | □ |

### 2.3 プロキシサーバーテスト

| No. | テスト項目 | 手順 | 期待結果 | 結果 |
|-----|------------|------|----------|------|
| 3-1 | LINE署名検証 | 不正な署名でリクエスト | 401エラーを返却 | □ |
| 3-2 | 転送処理 | 正常なWebhookを受信 | ローカルサーバーに転送 | □ |
| 3-3 | エラー処理 | ローカルサーバー停止時 | 適切なエラーレスポンス | □ |
| 3-4 | タイムアウト | 応答遅延時 | タイムアウトエラー処理 | □ |
| 3-5 | 再試行 | 一時的な接続エラー時 | 自動再試行が機能 | □ |

### 2.4 統合テスト

| No. | テスト項目 | 手順 | 期待結果 | 結果 |
|-----|------------|------|----------|------|
| 4-1 | エンドツーエンド | LINEからメッセージ送信 | Obsidianにファイル作成 | □ |
| 4-2 | 設定変更 | ポート番号変更 | サーバーが再起動 | □ |
| 4-3 | プラグイン再起動 | Obsidian再起動 | 設定が保持される | □ |
| 4-4 | 並行処理 | 複数メッセージを同時送信 | すべて正常に処理 | □ |
| 4-5 | ネットワーク切断 | インターネット接続断 | 適切なエラー通知 | □ |

### 2.5 セキュリティテスト

| No. | テスト項目 | 手順 | 期待結果 | 結果 |
|-----|------------|------|----------|------|
| 5-1 | トークン検証 | 不正なトークンでアクセス | アクセス拒否 | □ |
| 5-2 | ポートスキャン | 外部からのアクセス試行 | アクセス拒否 | □ |
| 5-3 | パス検証 | 不正なファイルパス指定 | エラーで保存失敗 | □ |
| 5-4 | データ検証 | 不正なデータ形式送信 | バリデーションエラー | □ |
| 5-5 | リソース制限 | 大量リクエスト送信 | 適切なレート制限 | □ |

## 3. 性能テスト

### 3.1 基本性能
- サーバー起動時間: 1秒以内
- メッセージ処理時間: 500ms以内
- ファイル保存時間: 200ms以内

### 3.2 負荷テスト
- 同時10リクエストの処理
- 1分間に100メッセージの処理
- 大量メッセージ（1000件）の連続処理

## 4. エラー復旧テスト

### 4.1 サーバー障害
- 異常終了からの再起動
- ポート開放失敗時の代替ポート使用
- 設定ファイル破損時の初期化

### 4.2 ネットワークエラー
- 接続タイムアウトからの復帰
- 一時的な接続エラーのリトライ
- DNS解決失敗時の処理

## 5. テスト実行環境

### 5.1 必要なツール
- curl（APIテスト用）
- Postman（API開発・テスト）
- Network Link Conditioner（ネットワーク状態シミュレーション）

### 5.2 テストデータ
- 標準的なテキストメッセージ
- 特殊文字を含むメッセージ
- 大容量テキストデータ

## 6. バグ報告形式

### 6.1 基本情報
- 発生日時
- テスト項目番号
- 再現手順
- 期待結果と実際の結果
- 環境情報

### 6.2 ログ情報
- プラグインのログ
- ローカルサーバーのログ
- Cloudflare Workersのログ

## 7. テスト結果の記録

### 7.1 テスト実施記録
- テスト実施日
- テスト担当者
- 合格/不合格の判定
- 発見された問題点
- フォローアップ事項

### 7.2 テスト結果の保存
- スクリーンショット
- ログファイル
- エラーメッセージ